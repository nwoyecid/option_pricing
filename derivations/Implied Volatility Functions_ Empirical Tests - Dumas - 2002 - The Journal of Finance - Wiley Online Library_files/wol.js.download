(function(a){a.widget("ol.dynamicSelectGroup",{_create:function(){this.element.wrap("<fieldset />");
this.element.parents("fieldset").parent().wrapInner('<form action="'+this.element.find("a:first").attr("href").split("?")[0]+'" class="simple" method="get" />');
this.element.parents("form").unwrap().append('<input type="submit" value="Download" class="submit"/>')
},_init:function(){this._build();
var b=this.element.parents("form").find("p.error");
if(b.length){this.element.parents("fieldset").append(a("<label/>").addClass("error").attr("for","productType").html(b.detach().html()))
}},_build:function(h,b){var g=this,i=h;
this.element.parents("fieldset").children("label.error").remove();
if(!h){this.element.find("~select").remove();
h=this.element
}else{var d=h.parents("ul").length;
this.element.find("~select").eq(d).find("~select").remove();
h=h.find(">li>ul").filter(function(j){return a(this).siblings("span").text()===a(b).find("option:selected").text()
})
}this.element.parent().children("input[type=hidden]").remove();
h.length&&(i=h);
var e={};
a.each(i.find("a:first").attr("href").split("?")[1].split("&"),function(){if(!g.element.parent().children("#"+this.split("=")[0]).length){e[this.split("=")[0]]=this.split("=")[1]
}});
while(h.length){var c=h.attr("class"),f=c.indexOf(" ")>0?c.split(" ")[1]:c;
delete e[f];
var b=a("<select />").hide().attr({id:f,name:f}).bind("change",{listEl:h},function(j){g._build(j.data.listEl,this)
}).appendTo(this.element.parent());
a(a.map(h.find(">li"),function(j){return a("<option />").attr("value",g._getValueFromQS(j,f)).text(a(j).children("span, a").text())
})).appendTo(b.fadeIn("slow"));
h=h.find(">li:first>ul:first")
}a.each(e,function(k,j){a("<input />").attr({type:"hidden",id:k,name:k}).val(j).appendTo(g.element.parent())
})
},_getValueFromQS:function(c,b){qs=a(c).find("a:first").attr("href").split("?")[1].split("&");
return a.grep(qs,function(d,e){return d.split("=")[0]===b
})[0].split("=")[1]
},destroy:function(){this.element.parent().find("select").remove();
this.element.show();
a.Widget.prototype.destroy.apply(this,arguments)
}});
a.widget("ol.dynamicReportScreen",{_create:function(){var b=this
},_init:function(){this._buildReport();
this._buildReportSection();
a("#reportMonthStart").val(1).attr("selected","selected");
var b=this.element.parents("form").find("p.error");
if(b.length){this.element.parents("fieldset").append(a("<label/>").addClass("error").attr("for","productType").html(b.detach().html()))
}},_getContext:function(){var c=a("#reportUrl").val(),b=location.protocol+"//"+location.host;
if(c==="/admin-tools-web"){b=b+"/admin-tools-web"
}return b
},_getExternalID:function(){var b=a("#externalID").val(),c=new RegExp("#","g");
b=b.replace(c,"%23");
return b
},_buildReportSection:function(){var i=this;
var d=a("#show_reports"),j=a("table.report"),f=a("#generate"),h=a(".delete_report"),c=a("#refresh_reports"),g=a("#message"),e=a("#dialog"),b=a(".ajax-loader");
d.click(function(k){b.show();
a("#report_list tbody").remove();
i._showReports();
j.slideToggle(300);
k.preventDefault()
});
f.click(function(k){i._validateForm();
k.preventDefault()
});
c.click(function(k){b.show();
a("#report_list tbody").remove();
i._showReports();
a("table.report").slideDown(300);
k.preventDefault()
})
},_validateForm:function(){var j=a("#productType option:selected").val(),k=a("#reportType option:selected").val(),h=a("#reportType option:selected").text(),l=a("#reportYear option:selected").val(),b="",q="",c="",p="",f="Reports cannot span more than 1 year <br />",d="Please enter a valid date range <br />",n=a("#count").html(),e="",g="";
if(h.indexOf("COUNTER")>-1||h==="Journal's Frontfile Report"){b=a("#reportMonthStart option:selected").val();
q=a("#reportMonth option:selected").val();
c=a("#reportYearStart option:selected").val();
e=l-c;
g=q-b
}else{if(h==="Database Report 1"||h==="Database Report 2"||h==="Platform Report 1"){b=a("#reportMonthStart option:selected").val();
q=a("#reportMonth option:selected").val();
c=a("#reportYearStart option:selected").val();
e=l-c;
g=q-b
}else{a("#reportMonthStart").empty()
}}n=(n>0)?parseInt(n,10)+1:1;
if((e===1&&g>=0)||e>1){p=f
}else{if(e<=0&&g<0){p=d
}else{if(e<0){p=d
}}}if(p){a("label.error").show().html(p)
}else{a(".ajax-loader").show();
var m=this,o=m._getContext(),i=a("#usage_report").serialize();
a.ajax({url:o+"/admin/queueReportRequest",type:"get",data:i,cache:false,success:function(r){if(r==="Success"){alert("Report added to queue")
}else{if(r==="exists"){alert("Report is currently in queue")
}else{if(r==="failure"){alert("Error-Please Try Again")
}}}if(r!==""){m._showReports();
a("table.report").slideDown(300)
}}})
}},_showReports:function(){var b=this._getContext(),d=this,f=a(".ajax-loader"),c=d._getExternalID(),e="";
if(c){e="externalID="+c
}a.ajax({url:b+"/admin/customerReports",type:"get",data:e,cache:false,success:function(r){a("#report_list tbody").remove();
var k=JSON.parse(r);
var y="";
for(var z in k){var v=k[z].id,s=k[z].displayReportType,D=k[z].displayReportName,C=k[z].startMonth,w=k[z].startYear,x=k[z].endMonth,o=k[z].endYear,n=k[z].displayReportStatus,l=k[z].downloadUrlfortsv,B=k[z].downloadUrlforcsv,u=k[z].downloadUrlforxml,j=k[z].downloadUrlforxlsx,t=k[z].reportCustID,g="",q='<img src="/images/bin.png" title="Delete" />',p="",m="";
var h=C+" / "+w,A=x+" / "+o;
if(n==="Error-Please Try Again"){m='class="errRow"'
}if(n==="Error-Please Try Again"||n==="Completed"){q='<a href="#" id="'+v+'" data-cust="'+t+'" class="delete">'+q+"</a>"
}if(c){p="&externalID="+c
}if(D==="COUNTER Consortium Report 1"){g=(n==="Completed")?'<a href="'+b+""+u+""+p+'">XML</a>':"XML"
}else{if(D.indexOf("COUNTER")>-1||D==="Journal's Frontfile Report"){g=(n==="Completed")?'<a href="'+b+""+j+""+p+'">XLSX</a> | <a href="'+b+""+l+""+p+'">TSV</a> | <a href="'+b+""+u+""+p+'">XML</a>':"XLSX | TSV | XML"
}else{if(D==="Database Report 1"||D==="Database Report 2"||D==="Platform Report 1"){g=(n==="Completed")?'<a href="'+b+""+j+""+p+'">XLSX</a> | <a href="'+b+""+l+""+p+'">TSV</a> | <a href="'+b+""+u+""+p+'">XML</a>':"XLSX | TSV | XML"
}else{A=o;
h="Not Applicable";
g=(n==="Completed")?'<a href="'+b+""+j+""+p+'">XLSX</a> | <a href="'+b+""+B+""+p+'">CSV</a>':"XLSX | CSV"
}}}y+="<tr "+m+"><td>"+s+"</td><td>"+D+"</td><td>"+h+"</td><td>"+A+"</td><td>"+n+"</td><td>"+g+"</td><td>"+q+"</td></tr>"
}a("#report_list").append(y);
f.hide()
}})
},_hideErrLabel:function(){a("label.error").hide()
},_buildReport:function(){var g=a("#productType"),h=a("#reportType"),k=a("#reportYearStart"),l=a("#reportYear"),i=a("#reportMonthStart"),e=a("#reportMonth"),b=a(".report_usage"),c=a(".reportMonthStartStyle"),d=a(".reportMonthStyle"),f=a(".reportYearStartStyle"),j=this;
b.find("> li > span").each(function(){var m=a(this);
g.append("<option value='"+m.attr("id")+"'>"+m.text()+"</option>")
});
g.change(function(){var m=g.find("option:selected").val().replace(/\s/g,"");
h.empty();
a("span."+m).each(function(){var n=a(this);
h.append("<option value='"+n.attr("id")+"'>"+n.text()+"</option>")
});
h.trigger("change")
});
h.change(function(o){var n=h.find("option:selected").val(),m=g.find("option:selected").val().replace(/\s/g,"");
k.empty();
l.empty();
a(".reportYearStart span."+m+"_"+n).each(function(){var p=a(this);
k.append("<option value='"+p.attr("id")+"'>"+p.text()+"</option>")
});
a(".reportYear span."+m+"_"+n).each(function(){var p=a(this);
l.append("<option value='"+p.attr("id")+"'>"+p.text()+"</option>")
});
k.trigger("change");
l.trigger("change")
});
k.change(function(p){j._hideErrLabel();
var o=k.find("option:selected").val(),m=h.find("option:selected").val(),n=g.find("option:selected").val().replace(/\s/g,"");
if(!o){f.hide();
c.hide()
}else{f.show();
c.show()
}i.empty();
a(".reportMonthStart span."+n+"_"+m+"_"+o).each(function(){var q=a(this);
i.append("<option value='"+q.attr("id")+"'>"+q.text()+"</option>")
});
i.val(1).attr("selected","selected")
});
l.change(function(q){j._hideErrLabel();
d.show();
var o=l.find("option:selected").val(),m=h.find("option:selected").val(),n=g.find("option:selected").val().replace(/\s/g,"");
e.empty();
var p=0;
a(".reportMonth span."+n+"_"+m+"_"+o).each(function(){var r=a(this);
e.append("<option value='"+r.attr("id")+"'>"+r.text()+"</option>");
p++
});
if(!p){d.hide()
}});
i.change(function(m){j._hideErrLabel();
m.preventDefault()
});
e.change(function(m){j._hideErrLabel();
m.preventDefault()
});
g.trigger("change")
}});
a.widget("ol.globalMessaging",{_create:function(){var b=this,c=b.options;
b=a.extend(b,{offset:0,showing:false,available:false,timer:0,isIe6:(a.browser.msie&&a.browser.version==6)});
b.messageElement=(a("#globalMessaging").length?a("#globalMessaging"):a("<div/>").attr("id","globalMessaging").append("<ul/>")).css({top:0,left:0,position:b.isIe6?"absolute":"fixed"}).append(a('<a id="handle" href="#">'+c.openedText+"</a>").click(function(){b.showing?b.hide():b.show(true);
return false
})).bgIframe();
if(b.messageElement.parent().length>0){b.available=true;
b.messageElement.detach().prependTo("body");
b._setOffset();
b.canShow=((b.messageElement.find("li").length>1)||((b.messageElement.find("li").length==1)&&((b.messageElement.find("li.maintenanceMessage").length==0)||(b.messageElement.find("li.maintenanceMessage").length>0)&&(a.cookie("maintenanceMessageViewed")!="true"))));
!b.canShow&&b.hide(true)
}a(window).bind("resize",function(){b.available&&((b.showing&&b._setOffset())||(b._setOffset()&&b.hide(true)))
});
if(b.isIe6){a(window).bind("scroll",function(){b.available&&((b.showing&&b.messageElement.css({top:a(window).scrollTop()}))||(!b.showing&&b.messageElement.css({top:a(window).scrollTop()+b._getOffset()})))
})
}},_init:function(){this.show()
},_getOffset:function(){return parseInt("-"+this.offset,10)
},_setOffset:function(){return this.offset=parseInt(this.messageElement.children("ul").outerHeight(),10)
},addMessage:function(d,c){var b=this;
b.hide(true);
b.messageElement.children("ul").append(a("<li>"+d+"</li>").attr("class",c));
b.messageElement.prependTo("#rightBorder");
b.available=true;
b._setOffset();
b.canShow=((b.messageElement.find("li").length>1)||((b.messageElement.find("li").length==1)&&(b.messageElement.find("li.maintenanceMessage").length>0)&&(a.cookie("maintenanceMessageViewed")!="true")));
if(b.canShow){b.show()
}else{b.hide(true)
}},show:function(d){var b=this,c=b.options;
if(this.available&&!b.showing&&(d||b.canShow)){b.messageElement.children("ul").css("visibility","visible");
b.messageElement.animate({left:0,top:b.isIe6?a(window).scrollTop():0},c.animSpeed,function(){b.messageElement.children("a").html(c.openedText);
if(!d){b.timer=setTimeout(function(){b.hide()
},c.delay)
}b.showing=true
});
(a.cookie("maintenanceMessageViewed")!="true")&&a.cookie("maintenanceMessageViewed","true",{path:"/"})
}},hide:function(d){var b=this,c=b.options;
if(this.available&&(b.showing||d)){clearTimeout(b.timer);
b.messageElement.clearQueue().animate({top:b.isIe6?a(window).scrollTop()+b._getOffset():b._getOffset()},d?0:c.animSpeed,function(){b.messageElement.children("a").html(c.closedText);
b.showing=false
})
}}});
a.extend(a.ol.globalMessaging.prototype,{options:{animSpeed:"fast",delay:5000,openedText:"Hide messages",closedText:"Show messages"}})
})(jQuery);
(function(b){var c=b("#reportUrl").val(),a=location.protocol+"//"+location.host;
if(c==="/admin-tools-web"){a=a+"/admin-tools-web"
}b("#report_list").delegate("a.delete","click",function(i){var h=b(this),l=h.attr("id"),k=h.attr("data-cust"),d=b("#externalID").val(),j=b(".ajax-loader").show(),f="",g=new RegExp("#","g");
d=d.replace(g,"%23");
if(d){f="&externalID="+d
}b.ajax({url:a+"/admin/archiveReport",data:"id="+l+"&custid="+k+""+f,type:"get",cache:false,success:function(e){if(e==="Success"){j.hide();
h.parent("td").parent("tr").fadeOut(500)
}}});
i.preventDefault()
})
})(jQuery);(function(a){a.widget("ol.reportScreen",{options:{reportType:"special_report",reportTypeTrigger:false,reportNameURL:"",reportNameUIURL:"",addReportURL:"",getReportsURL:"",deleteReportURL:""},vars:{reportHTML:"",$ajaxLoader:""},_create:function(){var b=this,d=b.options,c=b.element;
this._createReportTypes()
},_getExternalID:function(){var b=a("#externalID").val(),c=new RegExp("#","g");
if(b){b=b.replace(c,"%23")
}return b
},_getContext:function(){var b=location.protocol+"//"+location.host;
return b
},_getReportGridHTML:function(){var b=this,c;
c+=' <div id="report_queue">';
c+='     <div id="dialog" title="Generate Report">';
c+='         <span id="message"></span>';
c+="     </div>";
c+='     <div class="refresh">';
c+='         <div style="float:left;">';
c+='             <a href="#" id="show_reports"><img src="/images/down_arrow.png" title="Expand Report Section" class="expand"></a> Report Queue';
c+="         </div>";
c+='         <div align="right">';
c+='             <a href="#" id="refresh_reports" alt="Refresh Report Queue" title="Refresh Report Queue"><img src="/images/refresh.png" title="Refresh"></a>';
c+="         </div>";
c+="     </div>";
c+='     <div class="ajax-loader">';
c+='         <img src="/images/ajax-loader.gif" alt="Loading ...">';
c+="     </div>";
c+='     <table border="0" cellpadding="5" cellspacing="2" class="report" id="report_list">';
c+="         <thead>";
c+='             <tr class="stripe">';
c+="                 <th><b>Report Type</b></th>";
c+="                 <th><b>Report Name</b></th>";
c+="                 <th><b>Start Date</b></th>";
c+="                 <th><b>End Date</b></th>";
c+="                 <th><b>Status</b></th>";
c+='                 <th colspan="2" rowspan="1"><b>Actions</b></th>';
c+="             </tr>";
c+="         </thead>";
c+="     </table>";
c+=" </div>";
return c
},_buildReportGrid:function(){var b=this,c=b.element,d=b._getReportGridHTML();
a(d).appendTo(c);
$ajaxLoader=a(".ajax-loader");
c.delegate("#refresh_reports, #show_reports","click",function(f){b._refreshReports(f)
})
},_createReportForm:function(){var b=this,d=b.options,c=b.element,e;
e+='<form action = "'+b.addReportURL+'" class="simple report_form" id="generateReports" method="post">';
e+="<fieldset></fieldset>";
e+="</form>";
c.children().wrapAll(e)
},_deleteReport:function(i){i.preventDefault();
$ajaxLoader.show();
var l=this,d=l.options,h=l.element,b=l._getContext(),j=a(i.target).parent("a"),c=j.attr("id"),g=j.attr("data-cust"),f=l._getExternalID(),k="";
if(f){k="&externalID="+f
}a.ajax({url:b+"/"+d.deleteReportURL,data:"id="+c+"&custid="+g+""+k,type:"get",cache:false,success:function(e){if(e==="Success"){$ajaxLoader.hide();
j.parent("td").parent("tr").fadeOut(500)
}}})
},_showReports:function(){var d=this,f=d.options,e=d.element,h=this._getContext(),c=d._getExternalID(),g=e.find("form").serialize();
var b=(f.reportType==="ol_access_report")?h:h+"/admin-tools-web";
a.ajax({url:h+"/"+f.getReportsURL,type:"get",data:g,cache:false,success:function(u){a("#report_list tbody").remove();
var n=JSON.parse(u);
var C="";
for(var D in n){var z=n[D].id,w=n[D].displayReportType,H=n[D].displayReportName,G=n[D].startMonth,A=n[D].startYear,B=n[D].endMonth,r=n[D].endYear,v=n[D].startDate,m=n[D].endDate,q=n[D].displayReportStatus,o=n[D].downloadUrlfortsv,F=n[D].downloadUrlforcsv,y=n[D].downloadUrlforxml,l=n[D].downloadUrlforxlsx,x=n[D].reportCustID,j="",t='<img src="/images/bin.png" title="Delete" />',s="",p="";
var k=G+"/"+v+"/"+A,E=B+"/"+m+"/"+r;
if(q==="Error-Please Try Again"){p='class="errRow"'
}if(q==="Error-Please Try Again"||q==="Completed"){t='<a href="#" id="'+z+'" data-cust="'+x+'" class="delete">'+t+"</a>"
}if(c){s="&externalID="+c
}if(H==="COUNTER Consortium Report 1"){j=(q==="Completed")?'<a href="'+b+""+y+""+s+'">XML</a>':"XML"
}else{if(H.indexOf("COUNTER")>-1||H==="Journal's Frontfile Report"){j=(q==="Completed")?'<a href="'+b+""+l+""+s+'">XLSX</a> | <a href="'+b+""+o+""+s+'">TSV</a> | <a href="'+b+""+y+""+s+'">XML</a>':"XLSX | TSV | XML"
}else{if(H==="Database Report 1"||H==="Database Report 2"||H==="Platform Report 1"){j=(q==="Completed")?'<a href="'+b+""+l+""+s+'">XLSX</a> | <a href="'+b+""+o+""+s+'">TSV</a> | <a href="'+b+""+y+""+s+'">XML</a>':"XLSX | TSV | XML"
}else{if(H==="journalsAccessReport"||H==="books_MRWs_AccessReport"||H==="databases_LabprotocolsAccessReport"){w=w.replace("?","'");
k="Not Applicable";
E="Not Applicable";
H="Customer Access Report";
j=(q==="Completed")?'<a href="'+b+""+l+""+s+'">XLSX</a> | <a href="'+b+""+F+""+s+'">CSV</a>':"XLSX | CSV"
}else{j=(q==="Completed")?'<a href="'+b+""+l+""+s+'">XLSX</a> | <a href="'+b+""+F+""+s+'">CSV</a>':"XLSX | CSV"
}}}}C+="<tr "+p+"><td>"+w+"</td><td>"+H+"</td><td>"+k+"</td><td>"+E+"</td><td>"+q+"</td><td>"+j+"</td><td>"+t+"</td></tr>"
}a("#report_list").append(C);
$ajaxLoader.hide();
e.find("#report_list").delegate("a.delete","click",function(i){d._deleteReport(i)
})
}})
},_buildReportButton:function(){var b=this;
this.vars.reportHTML+='<input type="submit" value="Generate" class="submit generatebtn" />';
a(this.vars.reportHTML).appendTo(this.element);
this._buildUIActions();
this._createReportForm();
if(a("#report_queue").length<1){b._buildReportGrid()
}},_addReport:function(h){h.preventDefault();
var b=this,d=b.options,c=b.element,j=this._getContext(),g=c.find("form").serialize(),f=a("#report_type option:selected").text(),i;
a.ajax({url:j+"/"+d.addReportURL,type:"GET",data:g,cache:false,success:function(e){var k=c.find(".report_error_msg");
if(k){k.remove()
}switch(e){case"Success":alert("Report added to queue");
break;
case"exists":alert("Report is currently in queue");
break;
case"failure":alert("Error-Please Try Again");
break;
case"invalidLicense":i="This customer does not have active licenses for "+f;
c.find("fieldset").append('<p class="report_error_msg">'+i+"</p>");
return;
break;
default:}if(e!==""){b._showReports();
a("table.report").slideDown(300)
}}})
},_buildReportTypeUI:function(g){var b=this,f=b.element,d=b.options,h=this._getContext(),c=a("#report_type").val();
a.ajax({url:h+"/"+d.reportNameUIURL,type:"GET",data:"reportType="+c,cache:false,success:function(e){var i='<div class="report-sub-block">'+e+"</div>";
if(a(".report-sub-block").length<1){a(g.target).parents(".report_type_block").after(i)
}else{a(".report-sub-block").html(e)
}}})
},_refreshReports:function(d){d.preventDefault();
var b=this,c=a(d.target).attr("class");
a(".ajax-loader").show();
a("#report_list tbody").remove();
b._showReports();
if(c==="expand"){a("table.report").slideToggle(300)
}else{a("table.report").slideDown(300)
}},_isLeapYear:function(c){var b=false;
c=parseInt(c,10);
if(((c%4===0)&&!(c%100===0))||(c%400===0)){b=true
}else{b=false
}return b
},_validateDate:function(g,f,e){var c=this,b=[1,3,5,7,8,10,12,1,3,5,7,8,"January","March","May","July","August","October","December","JAN","MAR","MAY","JUL","AUG","OCT","DEC"],d=true;
if(g==="02"||g==="2"||g==="FEB"||g==="February"){e=parseInt(e,10);
if(e<=28||(e===29&&c._isLeapYear(f))){d=true
}else{d=false
}}else{if(a.inArray(parseInt(g,10),b)===-1){if(parseInt(e,10)>30){d=false
}}}return d
},_setError:function(b){if(b!==""){if(a(".report_error_msg").length>0){a(".report_error_msg").html(b)
}else{this.element.find("fieldset").append('<p class="report_error_msg">'+b+"</p>")
}}else{a(".report_error_msg").remove()
}},_validateEmptyArr:function(b){var c=true;
a.each(b,function(d,e){if(e===""){c=false
}});
return c
},_validReport:function(){var q=this,c=q.options,n=true,i=q.element,b=a("#report_type"),g;
if(c.reportType==="special_report"){var l=a(".reportMonthStart").val(),o=a(".reportDayStart").val(),f=a(".reportYearStart").val(),e=a(".reportMonthEnd").val(),r=a(".reportDayEnd").val(),h=a(".reportYearEnd").val(),k=[l,o,f,e,r,h];
if(!q._validateEmptyArr(k)){n=false;
q._setError("Required Field")
}else{var d=new Date(f,l-1,o),j=new Date(h,e-1,r),m=j-d,p=m/1000/60/60/24;
if(d>j){n=false;
q._setError("End date must be greater than Start date")
}else{if(p>=365){if(p===365&&(q._isLeapYear(f)||q._isLeapYear(h))){n=n
}else{n=false;
q._setError("Invalid date range")
}}else{if(!q._validateDate(l,f,o)){n=false;
q._setError("Invalid start date")
}else{if(!q._validateDate(e,h,r)){n=false;
q._setError("Invalid end date")
}else{q._setError("")
}}}}}}return n
},_buildUIActions:function(){var c=this,d=c.options,b=a("#report_type");
if(d.reportTypeTrigger){b.change(function(f){c._buildReportTypeUI(f)
});
b.trigger("change")
}this.element.delegate("#generateReports","submit",function(f){if(c._validReport()){c._addReport(f)
}f.preventDefault()
})
},_createReportTypes:function(){var b=this,c=b.element;
opt=b.options,curURL=this._getContext(),vars=this.vars;
a.ajax({url:curURL+"/"+opt.reportNameURL,data:"",type:"GET",error:function(d){alert("Something went wrong !! Please try again after sometime")
},success:function(d){var e=c.attr("id");
if(e){vars.reportHTML+='<input type="hidden" name="externalID" id="externalID" value="'+c.attr("id")+'"/>'
}if(opt.reportType==="special_report"){vars.reportHTML+='<div class="report_type_block report_type_block--special"> '+decodeURIComponent(d)+" </div>"
}else{vars.reportHTML+='<div class="report_type_block"> '+decodeURIComponent(d)+" </div>"
}b._buildReportButton()
}})
}})
})(jQuery);$(function(){$("#fulltext .graphicalAbstract .figZoom, #graphicalAbstract .figZoom").click(function(){$.fancybox.staticUseSetup();
$.fancybox.showActivity();
var d=$(this);
var c=d.attr("href");
var b=new Image();
$(b).load(function(){$.fancybox.hideActivity();
$.fancybox({padding:10,margin:0,scrolling:"yes",content:this,titleShow:false,autoScale:true,onComplete:function(){}})
}).attr("src",c);
return false
});
$("#fulltext .figZoom, #fulltext .figures .figure").click(function(){$.fancybox.staticUseSetup();
$.fancybox.showActivity();
var g=$(this),d=$(this).attr("href"),c=new Image(),f,e=$(this).parents(".figure").find(".caption .downloadToPowerpoint a").attr("href"),b=$("<div />");
if(e){f=e.replace("#","%23")
}$(c).load(function(){$.fancybox.hideActivity();
$(c).css("margin","10px").appendTo(b);
var i=g.parent().find(".caption").clone();
i.find(".downloadToPowerpoint").remove();
i.find("a").click(function(){$.fancybox.close()
});
i.css({"padding-top":"10px","padding-left":"10px","padding-right":"10px"}).appendTo(b);
b.width($(c).attr("width")+20);
if(f){var h=$("<div id='figureNavigation'><a class='powerPoint' href='"+f+"'>Download figure to PowerPoint</a></div>");
h.appendTo(b)
}$.fancybox({padding:0,margin:0,content:b,titleShow:false,autoScale:true,onComplete:function(){}})
}).attr("src",d);
return false
});
if($("#totalViews span").text()!=0){$('<a href="metrics">view chart</a>').appendTo("#totalViews")
}if($("#totalViewsError span").text()==0){$('<a href="metrics">view chart</a>').appendTo("#totalViewsError")
}$("#mrwFulltext .fig-thumbnail-href").filter(function(){return $(this).attr("href").indexOf("tables#")==-1
}).click(function(){$.fancybox.staticUseSetup();
$.fancybox.showActivity();
var d=$(this);
var c=$(this).attr("href");
var b=new Image();
$(b).load(function(){$.fancybox.hideActivity();
var h=$("<div />").css("padding","10px");
var f=$("<div />");
$(b).appendTo(f);
if(d.parent("td").length){var e=$("<p />").css({"padding-top":"10px","margin-bottom":"0"});
var g=(d.parent().nextAll("td").length==1)?d.parent().next().html():d.text();
e.html(g).appendTo(f)
}h.width($(b).attr("width")+20);
f.appendTo(h);
$.fancybox({padding:0,margin:0,content:h,titleShow:false,autoScale:false,onComplete:function(){h.width((h.parent().height()<h.parent().attr("scrollHeight"))?h.width()-20:h.width())
}})
}).attr("src",c);
return false
});
$(".articleAbstract > .figZoom").fancybox({titleShow:false,cyclic:false,autoScale:false});
$(".imageTable img").css("cursor","pointer").click(function(){$.fancybox.staticUseSetup();
$.fancybox.showActivity();
var b=$(this);
$.fancybox({titleShow:false,cyclic:false,autoScale:false,content:b.clone()});
return false
});
$(".footnoteLink, .referenceLink").click(function(){var e=$(this);
if(e.attr("href").indexOf("/doi/")===-1){$.fancybox.staticUseSetup();
var d=$("<ul id='overlayList' />"),c=e.attr("rel"),b=12;
$.each(c.split("#"),function(h,l){if(l.indexOf("#")===-1&&h!==0){var i=l.replace(".","\\."),k=$("#"+i).clone(),j=$("<a />"),f,g;
j.attr("href","#"+l);
j.click(function(){$.fancybox.close()
});
f=k.find(".text");
if(f.length){f.wrap(j)
}else{g=k.find("cite");
g.wrap(j)
}b+=$("#"+i).height();
k.appendTo(d)
}});
$.fancybox({content:d,width:762,height:b,autoDimensions:false,autoScale:false,centerOnScroll:true});
return false
}});
$("#viewPrivacyPolicy, #viewTermsAndConditions").fancybox({titleShow:false,width:800,autoDimensions:false,autoScale:false,cyclic:false});
$(".payPerViewForm .fieldAssistance > a").fancybox({titleShow:false,width:480,height:410,autoDimensions:false,autoScale:false,cyclic:false});
$("li.email > a").fancybox({titleShow:false,width:620,height:410,autoDimensions:false,autoScale:false,cyclic:false,onComplete:function(){$(".captcha").simpleCaptcha()
}});
$("li.citation > a").fancybox({titleShow:false,cyclic:false,onComplete:function(){$("#exportCitation #citationFormat").bind("change",function(){var b=$(this).parents("form");
if($(this).val()==="REFWORKS"){b.attr("target","_blank");
$('<p class="fieldAssistance">This option will open up a new window.</p>').insertAfter(this)
}else{b.removeAttr("target").find(".fieldAssistance").remove()
}});
$("#performExportCitation").click(function(){$.fancybox.close()
})
}});
$("a[href='downloadstats']").fancybox({titleShow:false,width:480,height:200,autoDimensions:false,autoScale:false,cyclic:false});
$("input[name='exportCitations']").click(function(h){var f=$(this),d=f.closest("form"),g=d.find(".access input[type=checkbox]:checked"),b=d.attr("action"),c="Please select a result to export citation.";
if(g.length>0){$.fancybox({href:b,titleShow:false,autoDimensions:true,autoScale:false,cyclic:false,ajax:{dataType:"html",type:"POST",data:d.serialize()+"&"+f.attr("name")+"="+f.attr("value"),dataFilter:function(i,e){return $.ol.cleanAJAXResponse(i).split('<div id="exportCitation">').join('<div id="exportCitation" style="width:480px">')
}},onComplete:function(){$("#exportCitation #citationFormat").bind("change",function(){var e=$(this).parents("form");
if($(this).val()==="REFWORKS"){e.attr("target","_blank");
$('<p class="fieldAssistance">This option will open up a new window.</p>').insertAfter(this);
$.fancybox.resize()
}else{e.removeAttr("target").find(".fieldAssistance").remove()
}})
}})
}else{$.fancybox({titleShow:false,autoDimensions:true,autoScale:false,cyclic:false,content:c})
}return false
});
$(".crossmark-link").fancybox({titleShow:false,width:550,height:550,autoDimensions:false,autoScale:false,cyclic:false,type:"iframe",href:$(this).attr("href")});
$("#accessDeniedOptions .institution-list, #athens .institution-list").fancybox({width:1068,height:550,autoDimensions:false,autoScale:true,type:"iframe"});
var a=$('.menuGroup a[href$="agu/alertmanager/load"]');
a.fancybox({titleShow:false,width:640,height:550,autoDimensions:false,autoScale:false,cyclic:false,type:"ajax",href:a.attr("href")+"?type=ajax",onComplete:function(){var b=$("#personalChoiceAlerts"),d=b.find(".societyAlertHeading"),c=b.find(".submit");
$("#fancybox-inner .contentAlerts").selectAll();
$("#fancybox-inner .societyEAlerts").tabToggle();
c.bind("click",function(g){var f=$(".alertResponse");
f.hide();
g.preventDefault();
$.ajax({type:"POST",url:b.attr("action")+"?type=ajax",data:b.serialize(),success:function(e){if(!f.length){f=$('<p class="alertResponse error"/>');
f.insertAfter(c)
}f.text(e).show()
},error:function(){if(!f.length){f=$('<p class="alertResponse error"/>');
f.insertAfter(c)
}f.text("There has been a problem saving your AGU E-Alerts.").show()
}})
})
}})
});var wol=this.wol||{};
wol.metrics=function(){this.fancyBoxWidth=752;
this.fancyBoxHeight=628;
this.viewsEndDate=$("#enddate").text();
this.viewsStartDate=$("#startdate").text();
this.chartCount=$("#totalViews span").text();
this.$dataTables=$(".dataTable").first();
this.ajaxURL=window.location.pathname.split("/").slice(0,-1).join("/")+"/metricsData",this.daySegment=7;
this.monthSegment=1;
this.quarterlySegment=1;
this.minDays=42;
this.$usageContainer=$(".usageStats");
this.flotContainerTabbed='<div class="tabbedContent"><ul><li class="active" id="cumulativeGraph"><span>Cumulative Usage</span></li></ul></div>';
this.flotContainer='<div id="flotGraph"><div id="graph"></div></div>'
};
wol.metrics.prototype={init:function(){this.bindTotalViews()
},ajaxCall:function(){var a=this;
$.fancybox.hideActivity();
$.ajax({type:"GET",url:this.ajaxURL,dataType:"html",success:function(c,b){$.fancybox({content:c,width:a.fancyBoxWidth,height:a.fancyBoxHeight,autoDimensions:false,autoScale:false,scrolling:"no"});
a.$dataTables=$("#fancybox-inner  .dataTable");
a.$usageContainer=$("#fancybox-inner .usageStats");
a.viewsEndDate=$("#enddate").text();
a.viewsStartDate=$("#startdate").text();
$("#fancybox-inner").children().removeAttr("id");
a.paintContainer();
a.paintGraph();
a.bindPlotHover();
wol.altmetrics.init()
}})
},bindPlotHover:function(){var a=this;
$("#graph").bind("plothover",function(c,d,b){if(b){$("body").append('<div class="flotToolTip"></div>');
a.toolTip($(".flotToolTip"),b)
}else{$(".flotToolTip").remove()
}})
},bindTotalViews:function(){var a=this;
if(this.chartCount!=0){$("#totalViews a").click(function(b){b.preventDefault();
$.fancybox.staticUseSetup();
$.fancybox.showActivity();
a.ajaxCall()
})
}else{$("#totalViewsError a").click(function(b){b.preventDefault();
$.fancybox.staticUseSetup();
$.fancybox.showActivity();
a.ajaxCall()
})
}},paintContainer:function(){this.$dataTables.each(function(a,b){$(this).hide()
});
this.$usageContainer.append(this.flotContainerTabbed);
this.$usageContainer.append(this.flotContainer)
},paintGraph:function(){var b=this.dataMapFlot("pdf").split("-"),e=JSON.parse(b[0]),i=b[1],a=this.dataMapFlot("html").split("-"),d=JSON.parse(a[0]),g=a[1],c=this.dateMapStartPadded().getTime(),j=this.dataMax(b[1],a[1]),f=this.tickSize(),k=this.dateTimeType();
end=this.dateMapEndPadded().getTime();
var h=this;
this.flot=$.plot($("#graph"),[{label:"PDF",data:e},{label:"HTML",data:d}],{yaxis:{max:j},xaxis:{mode:"time",timeFormat:k,tickSize:f,min:c,max:end},legend:{position:"nw"},lines:{show:"true"},points:{show:"true"},grid:{hoverable:true,clickable:true,backgroundColor:"#fff",color:"#000",borderWidth:1,borderColor:"#ccc"},colors:["#b695ff","#007E8B"]})
},parseTableData:function(){var a=this;
this.data=[];
this.$dataTables.each(function(c,d){var b={};
b.data=[];
$(d).find("tr").each(function(g,e){if(g!==0){var f={};
f.date=a.dateConverter($(e).find("th").text());
f.pdf=$(e).find("td").first().text();
f.html=$(e).find("td").last().text();
b.data.push(f)
}});
b.start=a.dateConverter($(d).find("th:eq(3)").text());
b.end=a.dateConverter($(d).find("th").last().text());
a.data.push(b)
});
return this.data
},dateConverter:function(a){if(!isNaN(a.substr(0,1))){return a
}else{return"01 "+a
}},dataMapFlot:function(a){var c=this;
var e=true;
var d=0;
var b=this.parseTableData();
var f=[];
f="[["+c.dateMapStartPadded().getTime()+",0]";
$.each(b[0].data,function(g,h){f+=",["+(new Date(h.date)).getTime()+","+h[a]+"]";
if(parseInt(h[a],10)>parseInt(d,10)){d=parseInt(h[a],10)
}});
f+="]";
f+="-"+d;
return f
},dateMapStart:function(){this.data=this.parseTableData();
this.start=this.data[0].start;
return this.start
},dateMapEnd:function(){this.data=this.parseTableData();
this.end=this.data[0].end;
return this.end
},padMonth:function(c,b){var d=new Date(c);
var a=new Date(d.getFullYear(),d.getMonth()+b,1);
return a
},padQuarter:function(c,b,d){var e=new Date(c);
var a=(e.getMonth()+1)%3;
if(d&&a==0){e=new Date(e.getFullYear(),e.getMonth()-3,1)
}else{e=new Date(e.getFullYear(),e.getMonth()-a,1)
}return e.setHours(1)
},padDay:function(b,d){var c=new Date(b);
var a=c.setDate(c.getDate()+d);
return a
},dateMapStartPadded:function(){this.start=this.dateMapStart();
if(this.startsWithNullValue()){if(this.isQuarterly()){this.newStart=this.padQuarter(this.start,-1);
return new Date(this.newStart)
}else{return new Date(this.start)
}}else{if(this.isDaily()){this.newStart=this.padDay(this.dateMapStart(),-1)
}else{if(this.isMonthly()){this.newStart=this.padMonth(this.start,-1)
}else{this.newStart=this.padQuarter(this.start,-1,true)
}}return new Date(this.newStart)
}},startsWithNullValue:function(){if(this.data[0].data[0].html==0&&this.data[0].data[0].pdf==0){return true
}},dateMapEndPadded:function(){this.end=this.dateMapEnd();
if(this.isDaily()){this.newEnd=this.padDay(this.dateMapStart(),42)
}else{this.newEnd=this.padMonth(this.end,3)
}return new Date(this.newEnd)
},tickSize:function(){var a;
if(this.isDaily()){a=[this.daySegment,"day"]
}else{if(this.isMonthly()){a=[this.monthSegment,"month"]
}else{if(this.isQuarterly()){a=[this.quarterlySegment,"quarter"]
}}}return a
},isDaily:function(){this.days=this.dateFromNow();
if(this.days<=this.minDays){return true
}},isMonthly:function(){this.days=this.dateFromNow();
if(this.days>=this.minDays&&this.days<=365){return true
}},isQuarterly:function(){this.days=this.dateFromNow();
if(!this.isDaily()&&!this.isMonthly()){return true
}},dataMax:function(b,a){this.vanillaMax=0;
this.maxValue=0;
if(parseInt(b,10)>parseInt(a,10)){this.vanillaMax=parseInt(b,10)
}else{this.vanillaMax=parseInt(a,10)
}this.days=this.dateFromNow();
if(this.days<4){this.maxValue=parseInt(this.vanillaMax,10)+(parseInt(this.vanillaMax,10)*1)
}else{if(this.days>3&&this.days<8){this.maxValue=parseInt(this.vanillaMax,10)+(parseInt(this.vanillaMax,10)*0.5)
}else{if(this.days>7&&this.days<31){this.maxValue=parseInt(this.vanillaMax,10)+(parseInt(this.vanillaMax,10)*0.2)
}else{this.maxValue=parseInt(this.vanillaMax,10)+(parseInt(this.vanillaMax,10)*0.1)
}}}return Math.ceil(this.maxValue)
},dateFromNow:function(){this.diff=new Date()-new Date(this.dateMapStart()).getTime();
this.day=60*60*24*1000;
this.diffDay=Math.ceil(this.diff/this.day);
return this.diffDay
},dateTimeType:function(){this.days=this.dateFromNow();
if(this.isDaily()){this.timeType="%d %b"
}else{this.timeType="%b %y"
}return this.timeType
},toolTip:function(a,b){if(b.dataIndex!==0){var c=this.tooltipHtml(b);
a.html(c);
a.css({opacity:0.8,top:(b.pageY+10)+"px",left:(b.pageX+5)+"px"});
a.fadeIn(200)
}},tooltipHtml:function(b){var d=new Date(this.viewsEndDate),a=new Date(this.viewsStartDate),c=new Date(b.datapoint[0]);
a.setHours(1);
d.setHours(1);
if(c.getTime()>=a.getTime()){startDateString=$.plot.formatDate(a,"%d %b %y")
}else{startDateString=$.plot.formatDate(c,"%b %y")
}if(c.getTime()==new Date(this.data[0].end).getTime()){endDateString=$.plot.formatDate(d,"%d %b %y")
}else{c.setHours(1);
if(!this.isDaily()){endDateString=$.plot.formatDate(c,"%b %y")
}else{endDateString=$.plot.formatDate(c,"%d %b %y")
}}if(b.dataIndex===1){return b.datapoint[1]+" "+b.series.label+" views "+endDateString
}else{return b.datapoint[1]+" "+b.series.label+" views "+startDateString+" - "+endDateString
}}};
$(document).ready(function(){window.metric=new wol.metrics();
window.metric.init()
});(function(a){a.fn.searchSelectAll=function(){return this.each(function(){var b=a(this).closest("ol, ul");
var c=a(this);
c.is(":checked")&&b.find("li > input").not(c).attr("checked","checked");
b.delegate("input","click",function(){if(a(this).attr("id")==c.attr("id")){if(a(this).is(":checked")){b.find("li > input").not(c).attr("checked","checked")
}else{b.find("li > input").attr("checked","")
}}else{if(a(this).is(":checked")){(b.find("li > input:checked").not(c).length==b.find("li > input").not(c).length)&&c.attr("checked","checked")
}else{c.attr("checked","")
}}})
})
};
a.fn.slider=function(){var c=a("#authorsDetail, #editorsDetail, #publicationHistoryDetails, #howToCite, #errata, #fundingInfo, #isbnInfo, #bookSeriesInfo");
var b=0;
var e=a("<a href='#'>(Show All)</a>");
if(c.length>0){var d=a('<p id="toggleAddInfo"></p>');
c.each(function(){var g=a(this);
var f;
g.bind("slider",function(){if(a(this).is(":visible")){a(this).slideUp();
b--
}else{a(this).slideDown();
b++
}if(b==0){e.text("(Show All)")
}else{if(b==c.length){e.text("(Hide All)")
}}});
if(a(this).attr("id")=="authorsDetail"){f="Author Information"
}else{if(a(this).attr("id")=="editorsDetail"){f="Editor Information"
}else{if(a(this).attr("id")=="publicationHistoryDetails"){f="Publication History"
}else{if(a(this).attr("id")=="howToCite"){f="How to Cite"
}else{if(a(this).attr("id")=="fundingInfo"){f="Funding Information"
}else{if(a(this).attr("id")=="isbnInfo"){f="ISBN Information"
}else{if(a(this).attr("id")=="bookSeriesInfo"){f="Book Series Information"
}else{f="Corrections"
}}}}}}}a("<a href='#'>"+f+"</a>").click(function(){g.trigger("slider");
return false
}).appendTo(d)
});
d.insertAfter("#additionalInformation .articleCategory");
e.click(function(){if(a(this).text()=="(Show All)"){c.show();
a(this).text("(Hide All)");
b=c.length
}else{c.hide();
a(this).text("(Show All)");
b=0
}return false
}).appendTo("#additionalInformation .articleCategory")
}};
a.fn.subjectTree=function(){var b=function(f){var c=a(this),i=c.children("div"),h=a("body").height();
c.parent().children("li").removeClass("hover");
i.css("width",c.find("ol").length*15+"em");
c.addClass("hover");
if(c.data("done")){return
}c.data("done",true);
var d=Math.floor(i.offset().top)+Math.floor(i.outerHeight())+130;
if(d>h){var g=h-d;
i.css("top",g)
}};
return this.each(function(){a(this).children("li").hover(b,function(){a(this).removeClass("hover")
}).children("a").attr("href","#").keydown(function(d){if(d.which==13){d.preventDefault();
var c=a(this).parent();
if(c.hasClass("hover")){c.removeClass("hover")
}else{b.call(c)
}return false
}}).end().find("> div li a").focus(function(){a(this).parent().addClass("hover")
}).blur(function(){a(this).parent().removeClass("hover")
})
})
};
a.fn.profileMenu=function(){return this.each(function(){var b=false;
a(this).hover(function(){if(!b){a(this).find("ul").fadeIn("fast",function(){});
b=true
}},function(){if(b){a(this).find("ul").fadeOut("slow",function(){b=false
})
}})
})
};
a.fn.issueTree=function(){this.each(function(){a(this).click(function(){var g=a(this).attr("href").split("/journal/")[1].split("/issues")[0];
var f=(a(this).attr("href")).split("?")[1].split("=")[1];
var e=a(this).next("ol");
if(e&&e.css("display")=="block"){e.slideUp(function(){a(this).prev().removeClass("open").addClass("closed");
c()
})
}else{if(e&&e.css("display")=="none"){e.slideDown(function(){a(this).prev().removeClass("closed").addClass("open");
c()
})
}else{if(!a(this).hasClass("fetching")){var h=a(this);
a.ajax({type:"GET",url:"/journal/"+g+"/issues/fragment?activeYear="+f+"&SKIP_DECORATION=true",dataType:"html",beforeSend:function(){a(h).removeClass("closed").addClass("fetching")
},success:function(i){a(h).after(a(i).css("display","none"));
a(h).next("ol").slideDown(function(){a(this).prev().removeClass("fetching").addClass("open");
c()
})
},error:function(i,j,k){a(this).prev().removeClass("fetching").addClass("closed")
}})
}}}return false
})
});
function c(){a.cookie("allIssuesTree",null,{path:"/"});
var e=[];
a(".issueVolumes>li").each(function(f,g){e[f]=a(g).find("ol").css("display")=="block"?1:0
});
a.cookie("allIssuesTree",b()+" "+e.join(""),{path:"/"})
}function d(){var f=a.cookie("allIssuesTree");
if(f&&f.substring(0,f.indexOf(" "))==b()&&a(".issueVolumes").length){var e=f.substr(f.indexOf(" ")+1).split("");
a(".issueVolumes>li").each(function(g,h){if(e[g]==1){a(h).find("a").click()
}})
}}function b(){var f=window.location.pathname;
var e=f.substr(f.indexOf("journal/"));
e=e.substring(0,e.indexOf("/issues"));
return e
}d();
return this
};
a.fn.selectAll=function(){(this.length>0)?a(".selectAll fieldset").show():0;
return this.each(function(){if(a(this).parents("ol").length==0){var d=a(this),c=d.parents("form"),b=c.find("div.selectAll input[type='checkbox']"),e=(d.parents("#admin").length>0)?c.find("td input[type='checkbox']"):c.find("div.access input[type='checkbox']");
if(d.hasClass("contentAlerts")){e=d.find(".societyAlertList input[type='checkbox']")
}c.delegate("input[type='checkbox']","click",function(f){if(a(this).parents("div").hasClass("selectAll")){if(a(this).is(":checked")){a(e).attr("checked","checked");
a(b).attr("checked","checked").next("label").text("Deselect All")
}else{a(e).removeAttr("checked");
a(b).removeAttr("checked").next("label").text("Select All")
}}else{if(e.filter(":checked").length===e.length){a(b).attr("checked","checked").next("label").text("Deselect All")
}else{a(b).removeAttr("checked").next("label").text("Select All")
}}})
}})
};
a.fn.selectAllNew=function(b){return this.each(function(g){var f=a('<div class="selectAll"><input type="checkbox" name="selectAll" class="selectAll" value="selectAll"/><label>Select All</label></div>');
var c="selectAll"+g;
f.find("input").attr("id",c).next().attr("for",c);
a.each(b,function(h,j){a(j)[h](f.clone())
});
var e=a(this).find("input[type='checkbox']:not(.selectAll)");
var d=a(this).find("input.selectAll");
a(this).delegate("input[type='checkbox']","click",function(){if(a(this).hasClass("selectAll")){if(a(this).is(":checked")){a(e).attr("checked","checked");
a(d).attr("checked","checked").next("label").text("Deselect All")
}else{a(e).removeAttr("checked");
a(d).removeAttr("checked").next("label").text("Select All")
}}else{if(e.filter(":checked").length==e.length){a(d).attr("checked","checked").next("label").text("Deselect All")
}else{a(d).removeAttr("checked").next("label").text("Select All")
}}})
})
};
a.fn.loginLabels=function(){return this.each(function(){a(this).val("");
if(a(this).val()!=""){a(this).prev().hide()
}a(this).focus(function(){a(this).prev().hide()
}).blur(function(){if(a(this).val()==""){a(this).prev().show()
}})
})
};
a.fn.contextFilter=function(){var b=a(".contextReceiver").clone();
return a(this).change(function(){var e=this,d=a(this).siblings(".contextReceiver"),h=a(e).find("option:selected").text(),g=b.clone(),f="",c=a('<optgroup label=""><option value="">Select your region</option></optgroup>');
if(!b.find("optgroup[label="+h+"]").length){d.find("option[selected]").removeAttr("selected");
d.val("");
d.prev("label").andSelf().hide()
}else{f=g.find("optgroup[label="+h+"]");
a(".contextReceiver").empty().append(c).append(f).prev("label").andSelf().show();
a(".contextReceiver optgroup").css({width:"100%"})
}}).trigger("change")
};
a.fn.fileUploadFix=function(){return this.each(function(){a("label[for='"+a(this).attr("id")+"']").after('<input id="'+a(this).attr("id")+'Dummy" class="fileUpload" style="width:12.35em" /><div class="dummyFileButton" id="'+a(this).attr("id")+'DummySubmit"><input type="button" value="Browse" class="dummyFileButton" /></div>').add(this).add("#"+a(this).attr("id")+"Dummy").add("#"+a(this).attr("id")+"DummySubmit").wrapAll(a('<div class="uploadContainer" />')).eq(1).addClass("fileUpload").css({opacity:"0","z-index":1}).change(function(){a("#"+a(this).attr("id")+"Dummy").val(a(this).val())
}).trigger("change")
})
};
a.fn.addResourceMenu=function(){var c={"1":{link:"http://olabout.wiley.com/WileyCDA/Section/id-390244.html",text:"Training and Tutorials"},"2":{link:"http://olabout.wiley.com/WileyCDA/Section/id-404512.html",text:"For Researchers"},"3":{link:"http://olabout.wiley.com/WileyCDA/Section/id-404513.html",text:"For Librarians"},"4":{link:"http://olabout.wiley.com/WileyCDA/Section/id-404518.html",text:"For Societies"},"5":{link:"http://olabout.wiley.com/WileyCDA/Section/id-404516.html",text:"For Authors"},"6":{link:"http://olabout.wiley.com/WileyCDA/Section/id-390236.html",text:"For Advertisers"},"7":{link:"http://olabout.wiley.com/WileyCDA/Section/id-390242.html",text:"For Media"},"8":{link:"http://olabout.wiley.com/WileyCDA/Section/id-390243.html",text:"For Agents"}};
var d=a('<div id="resourcesMenu"></div>');
var b=a("<ul/>");
jQuery.each(c,function(f,e){a("<li><a href="+e.link+">"+e.text+"</a></li>").appendTo(b)
});
a(b).appendTo(d);
a(this).append(d)
};
a.fn.mrwTables=function(){return this.each(function(){a('<a href="#" class="viewTable">View table</a>').prependTo(a(this).children(".title")).toggle(function(){a(this).text("Hide table").parent().next(".table-container").slideDown("fast",function(){a(this).css("zoom",1)
});
return false
},function(){a(this).text("View table").parent().next(".table-container").slideUp();
return false
});
location.hash.split("#")[1]&&(a(this).attr("id")==location.hash.split("#")[1])&&a(this).find(".viewTable").trigger("click")
})
};
a.fn.jumpList=function(){if(this.length<1){return
}var e=this,g=e.first(0),b=g.parent().width(),d=a('<select class="jumpSelect" ><option value="jumpTo">Jump to&hellip;</option></select>');
didScroll=true,options="",selectWidth=g.width()+55;
a("#content").delegate(".jumpSelect","change",function(){var h=a(this);
window.location.hash="";
window.location.hash=h.val();
h.val("jumpTo");
a(document).trigger("scroll")
}).delegate(".jumpSelect","focusin, mousedown",function(){var h=a(this);
if(h.find("option").length===1){h.append(options)
}});
options=(function f(){var l,n=g.children("li").find("a:first"),k=n.length,j,h,m=[];
for(l=0;
l<k;
l++){j=n.eq(l);
h=j.getAltAndText();
(h.length>120)&&(h=h.substring(0,120)+"&hellip;");
m[l]='<option value="'+j.attr("href")+'">'+h+"</option>"
}return m.join("")
})();
if(selectWidth<=b){d.css("width",((selectWidth<438)?selectWidth:438))
}else{d.css({clear:"left",width:"100%",marginLeft:0})
}a(window).resize(function(){didScroll=true
}).scroll(function(){didScroll=true
});
setInterval(function(){if(didScroll){didScroll=false;
c(e)
}},500);
function c(h){h.each(function(){var j=a(this),l=j.prev(),i=a(document).scrollTop(),k=l.offset().top;
if((k>i-20)&&(k<i+a(window).height())){if(!l.find(".jumpSelect").length){d.clone(true).prependTo(j.prev())
}}})
}};
a.fn.getAltAndText=function(){var b=this.find("img");
if(b.length){a.each(b,function(){var c=a(this);
c.replaceWith(c.attr("alt"))
})
}return this.html()
};
a.fn.socialBookmarks=function(){return this.each(function(){var c='<a href="http://www.addthis.com/bookmark.php?v=250&amp;username=ra-51225be51b56b4c4" class="addthis_button_compact">Share</a>',d='<span class="addthis_separator">|</span>',b='<a class="addthis_button_citeulike"></a><a class="addthis_button_facebook"></a><a class="addthis_button_delicious"></a><a class="addthis_button_www.mendeley.com"></a><a class="addthis_button_twitter"></a>';
a("<div/>",{"class":"addthis_toolbox addthis_default_style"}).html(c+d+b).insertAfter(a(this))
})
};
a.fn.selectText=function(){var d=a(this)[0];
if(a.browser.msie){var b=document.body.createTextRange();
b.moveToElementText(d);
b.select()
}else{if(a.browser.mozilla||a.browser.opera){var c=d.ownerDocument.defaultView.getSelection();
var b=d.ownerDocument.createRange();
b.selectNodeContents(d);
c.removeAllRanges();
c.addRange(b)
}else{if(a.browser.safari){var c=d.ownerDocument.defaultView.getSelection();
c.setBaseAndExtent(d,0,d,1)
}}}return this
};
a.fn.loadDataTable=function(){return this.each(function(){var c=a(this).find("p a").attr("href"),b=a("<div class='loading'>Loading usage data&hellip;</div>"),d=a(this);
d.empty();
d.css("display","block");
d.append(b);
a.ajax({url:c,success:function(e){d.find(".loading").slideUp();
d.append(e);
a(d).clipBoard()
},error:function(e){d.find(".loading").html("Error displaying usage data");
d.find(".loading").addClass("error")
}})
})
};
a.fn.clipBoard=function(){if(typeof ZeroClipboard!="undefined"){var c=null,d,b;
if(location.protocol=="file:"){d="../js/zeroclipboard/zeroclipboard10.swf"
}else{if(location.host=="showroom.wiley.com"){d="http://showroom.wiley.com/projectAssets/srSubversionStorageAccessor/6ce4edfd0253e5c0fe8cc6ea3931e2ce/-1/zeroclipboard/zeroclipboard10.swf"
}else{d=location.protocol+"//"+location.host+"/js/zeroclipboard/zeroclipboard10.swf"
}}d=d.replace(/onlinelibrary/,"onlinelibrarystatic");
ZeroClipboard.setMoviePath(d);
c=new ZeroClipboard.Client();
a("#usageData table tbody tr td, input#tableCopyButton").mouseover(function(){b=a(this);
c.setText(this.innerHTML);
if(c.div){c.receiveEvent("mouseout",null);
c.reposition(this)
}else{c.glue(this)
}if(b.attr("id")!="tableCopyButton"){c.setHandCursor(false);
a("#ZeroClipboardMovie_1").parent().width(a(b).width()+10).height(a(b).height()+10);
a("#ZeroClipboardMovie_1").width(a(b).width()+10).height(a(b).height()+10)
}else{c.setHandCursor(true);
a("#ZeroClipboardMovie_1").parent().width(a(b).width()).height(a(b).height());
a("#ZeroClipboardMovie_1").width(a(b).width()).height(a(b).height());
c.setText("<table>"+a("#usageDataTable").html()+"</table>")
}c.receiveEvent("mouseover",null)
});
c.addEventListener("onComplete",function(){var e=a('<label class="advice">Copied table to clipboard</label>'),f=b.attr("id");
if(f=="tableCopyButton"){b.parent().find("label").each(function(){a(this).remove()
});
a(b).after(e);
a(e).delay(7000).fadeOut()
}else{a(b).selectText()
}})
}};
a.fn.unEscapeHtml=function(d){var c=[];
(d)&&a.extend(c,d);
var b={renderHtmlTag:function(e){for(var h=0;
h<c.length;
h++){var g=new RegExp("&lt;"+c[h]+"&gt;","gi"),f=new RegExp("&lt;/"+c[h]+"&gt;","gi");
startMatches=a(e).html().match(g)||[],endMatches=a(e).html().match(f)||[];
for(var l=0;
l<startMatches.length;
l++){if(endMatches[l]!=null){var j=new RegExp(startMatches[l],""),k=new RegExp(endMatches[l],"");
a(e).html(a(e).html().replace(j,"<"+c[h]+">"));
a(e).html(a(e).html().replace(k,"</"+c[h]+">"))
}}}}};
return this.each(function(){a(this).find("p").each(function(){b.renderHtmlTag(a(this))
})
})
};
a.fn.requestCSV=function(){if(this.length<1){return
}return this.each(function(){var b=a(this),c=b.find("a.proceed");
c.click(function(d){b.slideUp(function(){b.remove()
});
d.preventDefault()
})
})
};
a.fn.processPaymentDetail=function(){if(a(this).length==0){return
}return this.each(function(){var i=a(this),h=i.find("form"),e=h.find('input.submit[value="Submit"]'),f=a('a, input[type="submit"]'),d=a("body");
e.removeAttr("disabled");
e.click(function(m){var k=a('<div class="processing"><p>Processing Payment Details</p></div>'),n=a('<input type="hidden" name="ajaxSource" value="true"/>'),j=a('<input type="hidden" name="_eventId_makePayment" value="_eventId_makePayment"/>'),l="An error has occurred.";
d.append(k);
h.append(n);
h.append(j);
a(".processing").css({height:a(document).height()});
if(i.find(".error").length>0){i.find(".error").each(function(){a(this).slideUp(function(){a(this).remove()
})
})
}a.ajax({type:"POST",data:a(h).serialize(),url:h.attr("action"),success:function(o){try{switch(o){case null:case"":b("The payment process has timed out.");
break;
case"transIdProcessed":b("Your order is being processed, please wait for this to complete. For any payment or access problems, please contact cs-journals@wiley.com.",false);
e.attr("disabled",true);
break;
default:c(JSON.parse(o),"post")
}g(k)
}catch(p){g(k);
b(l)
}},error:function(o){g(k);
b(l)
}});
n.remove();
j.remove();
m.preventDefault()
});
var c=function(k,l){if(k.wpgAvailable==="true"){var j=a("<form></form>").attr({method:l,action:k.URL});
a.each(k.success,function(m,n){a.each(n instanceof Array?n:[n],function(o,p){a(document.createElement("input")).attr({type:"hidden",name:m,value:p}).appendTo(j)
})
});
d.append(j);
j.submit()
}else{b("Sorry, the Payment Gateway is not available. Please try again later.",false)
}};
var g=function(j){j.fadeOut(function(){a(this).remove()
})
};
var b=function(m,l){l=typeof l!=="undefined"?l:true;
var j=a('<div class="error">'+m+" </div>"),k=a('<a href="#" class="timeout-refresh">Please click here to continue.</a>');
a(k).click(function(n){location.reload(true);
n.preventDefault()
});
if(l){j.append(k)
}a(".payPerViewForm").before(j)
}
})
};
a.fn.tabToggle=function(){if(a(this).length==0){return
}return this.each(function(){var d=a(this),b=d.find(".tabbedContent"),c=d.find(".tabContent");
b.delegate("li a","click",function(h){var g=a(this),f=g.parent().index();
h.preventDefault();
b.find("li").each(function(){var i=a(this),e=i.index();
if(e!==f){i.removeClass("active");
c.eq(e).hide()
}else{g.parent().addClass("active");
c.eq(f).show()
}})
})
})
}
})(jQuery);var wol=this.wol||{};
wol.treeListMenu=function(c,a,b){this.topParent=a;
this.tree=a;
this.branchSelector=b||"li > span";
this.branches=[];
this.defaults={expandAll:false,collapseAll:false,ajax:false,branchLabelLink:false};
$.extend(this.defaults,c)
};
wol.treeListMenu.prototype={init:function(){var b=this,a=this.defaults.collapseAll?"branchLabel closed":"branchLabel open";
if(!b.defaults.ajax){$(this.tree).find(this.branchSelector).each(function(){var e=$(this),d=e.is("a"),c=d?e.addClass(a):e.removeAttr("class").wrap('<a href="#" class="'+a+'"></a>').parents("a"),f=new wol.treeListMenu.branch(c,b.defaults.branchLabelLink,b.topParent);
f.init();
b.branches.push(f)
})
}else{$(this.tree).find("li > a.branchLabel").each(function(){var c=$(this).next("ol, ul");
if(c.length>0){var d=new wol.treeListMenu.branch($(this));
d.init();
b.branches.push(d)
}else{$(this).click(function(){c=$(this).next("ol, ul");
if(!c.length){var e=new wol.treeListMenu.ajax($(this));
e.init()
}return false
})
}})
}if(b.defaults.collapseAll){this.tree.addClass("treeListMenuCollapse");
this.collapseAll()
}if(b.defaults.expandAll){this.expandAll()
}},collapseAll:function(){if(!this.branches.length){$(this.tree).find("li > a.open").removeClass("open").addClass("closed").next("ol, ul").hide()
}},expandAll:function(){var a=this;
if(!this.branches.length){$(this.tree).find("li > a.closed").removeClass("closed").addClass("open").next("ol, ul").show()
}}};
wol.treeListMenu.branch=function(b,c,a){this.branch=b;
this.branchLabelLink=c;
this.tree=a
};
wol.treeListMenu.branch.prototype={init:function(){var a=this;
if(this.tree){this.tree.delegate("a.branchLabel","click",a.toggle)
}else{$(this.branch).click(function(b){a.toggle(b)
})
}},toggle:function(f){var b=this,d=$(this.branch),a=d.parent(),c=$(f.currentTarget);
if(c.hasClass("closed")){c.removeClass("closed").addClass("open");
if(b.branchLabelLink){b.createBranchLabelLink($(b.branch))
}c.parent().children("ol, ul").slideDown(function(){if(b.branchLabelLink){a.children(".branchLabelLink").show()
}})
}else{c.removeClass("open").addClass("closed");
c.parent().children("ol, ul").slideUp(function(){if(b.branchLabelLink){a.children(".branchLabelLink").hide()
}})
}return false
},createBranchLabelLink:function(c){var b=this,a=c.parent().find(".branchLabelLink");
if(!a.length){c.after('<a href="'+c.attr("href")+'" class="action branchLabelLink">View all</a>')
}else{a.show()
}}};
wol.treeListMenu.ajax=function(a){this.parent=a
};
wol.treeListMenu.ajax.prototype={init:function(){var a=this.parent;
if(!a.hasClass("fetching")){$.ajax({type:"GET",url:$(a).attr("href"),dataType:"html",dataFilter:function(c,b){return $.ol.cleanAJAXResponse(c)
},beforeSend:function(){$(a).removeClass("closed").addClass("fetching")
},success:function(b){$(a).after($(b).css("display","none"));
$(a).next("ol, ul").slideDown(function(){$(a).removeClass("fetching").addClass("open")
});
var d=new wol.treeListMenu.branch($(a));
d.init();
var c=new wol.treeListMenu({ajax:true,collapseAll:true},$(a).next("ol, ul"));
c.init();
wol.rightsLink.init()
},error:function(b,c,d){$(a).removeClass("fetching").addClass("closed")
}})
}}};
$(document).ready(function(){if($("#mrwBrowseByTOC").length){mrwTOCNavigator=new wol.treeListMenu({collapseAll:true},$("#browseMrw"));
mrwTOCNavigator.init()
}if($("#mrwBrowseByTopic").length){mrwTopicNavigator=new wol.treeListMenu({ajax:true},$("#browseMrw"));
mrwTopicNavigator.init()
}if($(".treeListMenu").length){var a=new wol.treeListMenu({branchLabelLink:true},$(".treeListMenu"),"li > .parent");
a.init()
}});if(!$("html").hasClass("js_en")){$("html").addClass("js_en")
}var proxied=((location.hostname.indexOf("onlinelibrary.wiley.com")!=-1)&&(location.hostname.substring(location.hostname.indexOf("onlinelibrary.wiley.com")+23)==""))?false:true;
var wol=this.wol||{};
$(function(){$.ol={};
$(".publicationTypes #allTypes,.subjectsAndAccess #allTopics, #allAsist").searchSelectAll();
$(document).globalMessaging();
wol.rightsLink.init();
if($("#accordion").length>0){$("#accordion").accordion({header:"h2"})
}$(".contextTrigger").contextFilter();
$("#additionalInformation").slider();
$("#login #loggedIn .profile>li").profileMenu();
$("#issueTocGroups, #titles, #publications, .articles, .books, .contentAlerts").selectAll();
$(".emrw-table").mrwTables();
$(".jumpList").jumpList();
$("#loginEmail, #loginPassword").loginLabels();
if($("#pdf").length){$(window).resize(function(){$("#pdf").children("iframe").height(($(window).height()-$("#pdfHeader").height())-2)
});
$(window).triggerHandler("resize")
}if(!$("#mailUpdates").attr("checked")){$("#mailUpdates").parents("fieldset").next().slideUp()
}$("#mailUpdates").click(function(){if($(this).attr("checked")){$(this).parents("fieldset").next().slideDown()
}else{$(this).parents("fieldset").next().slideUp()
}});
$(".issuesInYear").issueTree();
$("#browseBySubject").subjectTree();
$("#globalMenu ul li:nth-child(3)").addResourceMenu();
$.ol.cleanAJAXResponse=function(j){if(j.indexOf("<body>")>-1){return/<body[^>]*>([\S\s]*?)<\/body>/.exec(j,"ig")[1]
}else{return j
}};
if(!$("#mailPromotionRequested").attr("checked")){$("#mailPromotionRequested").parents("fieldset").next().hide()
}$("#mailPromotionRequested").click(function(){if($(this).attr("checked")){$(this).parents("fieldset").next("fieldset").slideDown()
}else{$(this).parents("fieldset").next("fieldset").slideUp()
}return true
});
$.ol.textSlider=function(j,k){$(j).each(function(){var m=$(this),l=m.height();
if(l>=200){m.css({height:"20em",overflow:"hidden",position:"relative",marginBottom:"0.5em"});
$("<a/>",{text:k[0]}).toggle(function(){$(this).text(k[1]);
m.height(l);
return false
},function(){$(this).text(k[0]);
m.height("20em");
return false
}).insertAfter(m).wrap('<p id="showContent">')
}})
};
$.ol.textSlider("#bookHome #homepageContent",["More about this book summary","Less about this book summary"]);
$.ol.textSlider("#bookHomeSeries #homepageContent",["More about this book series","Less about this book series"]);
if($("#mrwHome").length>0){$.ol.textSlider("#mrwHome #homepageContent:has(~ #rightColumn, ~ #leftColumn)",["More about this book","Less about this book"])
}($.ol.keyStrokeCollector=function(){$(document).keydown(function(k){var j={ctrl:(k.ctrlKey)?true:false,shift:(k.shiftKey)?true:false,alt:(k.altKey)?true:false,key:k.keyCode};
$(this).data("keyDown",j)
});
$(document).keyup(function(j){$(this).removeData("keyDown")
})
})();
$(".decisionTree").dynamicSelectGroup();
$(".report_usage").dynamicReportScreen();
if($("#searchByCitation").length){$("#scope").append('<option value="byCitation">By Citation</option>');
$("#scope").change(function(){if($(this).find("option:selected").text()=="By Citation"){$("#searchByCitation").slideDown(function(){$("#searchText, #searchSiteSubmit").attr("disabled","disabled")
})
}else{$("#searchByCitation").slideUp(function(){$("#searchText, #searchSiteSubmit").removeAttr("disabled")
})
}});
$("#searchByCitation p.error").length&&$("#scope").val("byCitation").triggerHandler("change")
}$("#resourcesMenu ul").bgiframe({top:20});
$("#issueToc .figZoom img").each(function(){var j=$(this);
if(j.height()>300){j.height(300)
}if(j.width()>300){j.css("float","none")
}j.css("visibility","visible")
});
$("#fulltext .firstPageContainer img").load(function(){$(this).removeAttr("height").removeAttr("width");
if($(this).width()>752){$(this).width(752)
}}).each(function(){if(this.complete||(jQuery.browser.msie&&parseInt(jQuery.browser.version)==6)){$(this).triggerHandler("load")
}});
$("#fulltext a.movingMolecule").each(function(){$(this).click(function(){window.open($(this).attr("href"),$(this).index(),"width=1024,height=790,scrollbars=yes");
return false
})
});
if($("meta[name='citation_journal_title']").length||($("#pdf").length&&$("#productTitle").length)){var e=($("#pdf").length)?$("#productTitle").attr("href").split("(ISSN)")[1]:$("meta[name='citation_issn']").attr("content");
var d=($("#pdf").length)?window.location.href.split("/doi/")[1].split("/pdf")[0]:$("meta[name='citation_doi']").attr("content");
$.getJSON("http://www.deepdyve.com/rental-link?docId="+d+"&fieldName=journal_doi&journal="+e+"&affiliateId=wiley&format=jsonp&callback=?",function(k){if(k.status==="ok"){var m=$('<p><a class="rentalLink">Rent this article at DeepDyve</a></p>');
var l=$('<div id="deepDyve" class="topLeftRoundCornerNew"><h2>Rent this article through DeepDyve</h2><p>View a read-only copy of this article through our partner DeepDyve, the largest online rental service for scientific and scholarly content. DeepDyve will safeguard user privacy and your information will not be sold to a third party.</p><p>Read more about our pilot program making a portfolio of Biotechnology journals available through DeepDyve.</p><p><a href="http://eu.wiley.com/WileyCDA/PressRelease/pressReleaseId-84017.html">Press Release</a></p></div>');
m.find("a").attr("href",k.url);
l.insertAfter("#accessDenied .access .login");
m.clone(true).insertAfter("#deepDyve p:first");
var j=$('<li><span style="color: red; padding-right: 0.4em; font-weight: bold;">NEW!</span> </li>');
m.find("a").clone(true).appendTo(j);
j.appendTo("#accessDeniedOptions")
}})
}$("#downloadStatisticalData form").live("submit",function(){var j=$(this).find("#tAndCs"),k=$(this).find("label[for='tAndCs']");
if(!j.is(":checked")){if($(this).find(".error").length==0){$('<label class="error" for="tAndCs">Please agree to the terms and conditions.</label>').insertAfter(k)
}return false
}});
$("#usageData").loadDataTable();
$("#usageReports .announcement").unEscapeHtml(["strong"]);
$(".societyEAlerts").tabToggle();
$("#currentHoldings .success, #currentHoldings .error ").requestCSV();
$("#payPerViewPaymentDetails").processPaymentDetail();
var a=$("#promosAndTools .titleTools");
if(a.length){var h=(document.location.protocol==="https:")?"https://":"http://",i=h+"s7.addthis.com/js/250/addthis_widget.js#async=1";
window.addthis_config={pubid:"ra-51225be51b56b4c4",services_compact:"digg,diigo,citeulike,googlereader,www.mendeley.com,stumbleupon,facebook,twitter,delicious,researchgate,reddit",services_custom:{name:"mendeley",url:"http://www.mendeley.com?url={{url}}&title={{title}}",icon:"http://www.mendeley.com/favicon.ico"},data_track_clickback:true};
function b(){var p=["compoundindex","otherversions","reflink","issuetoc","pdf","abstract","figures","specialsection","full","tables","ppvFlow","references","summary","suppinfo","citedby"];
var n=document.URL,l=n.split("doi/"),q=l[0],m=l[1],k="",j=p.length,o;
for(o=0;
o<j;
o++){if(m.match(p[o])){k=m.split("/"+p[o]);
break
}}return q+"resolve/doi?DOI="+k[0]
}function c(p,j,m,s){var l=p+j,k=(s==="twitter")?p:l,o=l.length,r=m;
if(o>r){var q=(o-r)+4,n=p.substring(0,p.length-q)+"....";
k=n
}return k
}var g={title:document.title.replace(/\-/g,""),url:b()};
window.addthis_share={title:g.title,url:g.url,passthrough:{twitter:{text:c(g.title,g.url,140,"twitter")}}};
$.getScript(i,function(){if(window.addthis){addthis.addEventListener("addthis.menu.share",function(){$("#at15s,#at16lb").css({display:"none",zIndex:"1"})
});
a.socialBookmarks();
addthis.init()
}})
}var f=window.institutions||[];
$("#institutionalAndAthensLogin #institutionName").autocomplete({source:f,minLength:2});
$(".wol_access_report_screen").reportScreen({reportType:"ol_access_report",reportTypeTrigger:false,reportNameURL:"admin/customer-access/fetchPageDetails",addReportURL:"admin/customer-access/queueReportRequest",getReportsURL:"admin/customer-access/fetchReports",deleteReportURL:"/admin/customer-access/archiveReport"});
$(".captcha").simpleCaptcha()
});
function toUnicode(a){var e="";
for(var b=0;
b<a.length;
b++){var d=a.charAt(b);
var c=a.charCodeAt(b);
if(c>"0xfff"){e+="\\u"+c.toString(16)
}else{if(c>"0xff"){e+="\\u0"+c.toString(16)
}else{if(c>"0x7f"){e+="\\u00"+c.toString(16)
}else{if(c<32){switch(d){case"\b":e+="\\b";
break;
case"\n":e+="\\n";
break;
case"\t":e+="\\t";
break;
case"\f":e+="\\f";
break;
case"\r":e+="\\r";
break;
default:if(c>"0xf"){e+="\\u00"+c.toString(16)
}else{e+="\\u000"+c.toString(16)
}break
}}else{switch(d){case"'":e+="\\'";
break;
case'"':e+='\\"';
break;
case"\\":e+="\\\\";
break;
case"/":e+="\\/";
break;
default:e+=d;
break
}}}}}}return e
};(function(f,d){var i,c,b,h,e=250;
var j=function(){i=d(".bannerWrapper");
c=i.find(".bannerDescription");
if(i.length){b=d('<a href="#" class="closeBanner" title="close">Close Banner</a>');
c.append(b);
a(true)
}},g=function(m){var k=(m!=null)?d(m.target):null,l=k.length?k.closest(".bannerWrapper"):null,n=(m!=null&&m.data!=null)?m.data.callback:null;
if(l.length){l.slideUp(e,function(){d(this).remove()
})
}a(false);
if(n&&typeof n==="function"){n()
}return false
},a=function(n){document.domain="wiley.com";
var l=d(parent.document.getElementsByTagName("frameset")[0]),o,m,k;
if(l.length){o=l.attr("rows");
m=parseInt(o.split(",")[0],10);
k=n?m+i.outerHeight():m-i.outerHeight();
l.attr("rows",o.replace(m,k))
}};
f.notification={dismiss:g,init:j};
return f
}(window.wol=window.wol||{},jQuery));
$(function(){wol.notification.init()
});(function(a,c){var b,f,d;
var e=function(){b=c("#cookieBanner");
f=b.find(".bannerDescription");
if(b.length){d=f.find(".closeBanner");
d.bind("click",{callback:function(){}},a.notification.dismiss)
}};
a.cookies={init:e};
return a
}(window.wol=window.wol||{},jQuery));
$(function(){wol.cookies.init()
});(function(a,e){var b,h,f,c=e(".shibbolethAccountControls"),d={create:"createPersonalShibbolethAccount",resign:"resignCreatingPersonalShibbolethAccount"};
var g=function(){b=e("#sttiBanner");
h=b.find(".bannerDescription");
if(b.length){f=h.find(".closeBanner");
f.bind("click",{callback:function(){var i="/closeCreatingPersonalShibbolethAccount";
e.post(i)
}},a.notification.dismiss)
}if(c.length){c.delegate(".shibbolethAccountControl","click",function(l){var j=this,k=j.id;
switch(k){case d.create:l.stopPropagation();
break;
case d.resign:var i=e(j).attr("href");
e.post(i,function(){var m=f.closest(".bannerWrapper");
if(m.length){m.slideUp(250,function(){e(this).remove()
})
}});
l.preventDefault();
break;
default:return false;
break
}})
}};
a.stti={init:g};
return a
}(window.wol=window.wol||{},jQuery));
$(function(){wol.stti.init()
});(function(l,j){var p=j(".shibbolethWidget"),y=j("#institutionName"),o=j("#institutionIdpUrl"),s=j("#selectInst"),r=p.find(".prevLogins"),k=p.find(".error"),b=r.find(".instName").length,x={};
var i=function(){s.removeClass("disabled").removeAttr("disabled");
y.removeClass("error ui-autocomplete-loading")
};
var a=function(){s.addClass("disabled").attr("disabled","disabled")
};
var e=function(z){if(z==="autocompleteselect"){k.remove()
}};
var d=function(A,z){x[A]=z
};
var m=function(z){return x[z]
};
var v=function(A,B){var z=[];
j.each(B,function(C,D){z.push({label:C,value:D})
});
d(A,z);
return z
};
var u=function(A,z){i();
z(A)
};
var f=function(C,z){var B=C.term.toLowerCase(),A=m(B);
if(A){u(A,z)
}else{j.ajax({url:"/widget/getinstitutiondetails",dataType:"json",data:{institutionname:encodeURIComponent(C.term)},success:function(E){var D=(E)?v(B,E):[];
u(D,z)
},error:function(E,F,D){return false
}})
}};
var c=function(z,A){y.val(A.item.label);
o.val(A.item.value);
e(z.type);
i();
return false
};
var h=function(){a();
y.autocomplete({source:f,minLength:3,select:c,focus:c,open:function(z,A){if(!j(".shibboleth-autocomplete").length){j(".ui-autocomplete").addClass("shibboleth-autocomplete")
}j(".ui-autocomplete").css("z-index",101)
}});
y.bind("blur keyup",function(){if(!y.val()){a()
}else{i()
}});
y.data("autocomplete")._resizeMenu=function(){this.menu.element.width(this.element.outerWidth()-2);
this.menu.element.css("top",parseInt(this.menu.element.css("top"),0))
};
y.data("autocomplete")._renderItem=function(B,D){var A=this.term.split(" ").join("|"),C=new RegExp("("+A+")","gi"),z=D.label.replace(C,"<b>$1</b>");
return j("<li></li>").data("item.autocomplete",D).append("<a>"+z+"</a>").appendTo(B)
}
};
var q=function(z){var A=j("#selectPrevInst");
z.prev(".rdo").attr("checked","checked");
A.trigger("click")
};
var g=function(A,z){var B=z.parent();
if(j.trim(A).toLowerCase()==="true"){B.fadeOut(900,function(){b--;
if(b===0){r.remove()
}j(this).remove()
})
}else{z.removeClass("waiting")
}};
var w=function(z){j.ajax({url:"/delinstitutionname",dataType:"text",charset:"utf-8",data:{institutionname:encodeURIComponent(z.val())},beforeSend:function(){z.addClass("waiting")
},success:function(A){g(A,z)
},error:function(B,C,A){return false
}})
};
var n=function(){r.delegate(".instLabel","click",function(){q(j(this))
}).delegate(".instName .actionBtn","click",function(A){A.preventDefault();
var z=j(this);
if(!z.hasClass("waiting")){w(z)
}})
};
var t=function(){if(y.length){h()
}s.val("Log in");
if(b){n()
}};
l.shibboleth={init:t};
return l
}(window.wol=window.wol||{},jQuery));
$(function(){wol.shibboleth.init()
});(function(a,c,e){var b=function(f){if(window.s&&s.apl){f.first().delegate("a","mouseenter",function(h){window.clearInterval(window.altmetricsPopover);
var g=c("#_altmetric_popover_el"),i=c(this);
if(g.is(":hidden")){window.altmetricsPopover=window.setInterval(function(){if(g.is(":visible")){window.clearInterval(window.altmetricsPopover)
}},500)
}})
}};
var d=function(){var h=c(".altmetric-embed");
if(h.length){var f=h.parents("#fancybox-inner").length,g="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js";
h=f?c("#fancybox-inner .altmetric-embed"):h;
if(window._altmetric){_altmetric_embed_init()
}else{c.getScript(g)
}b(h)
}};
a.altmetrics={init:d};
return a
}(window.wol=window.wol||{},jQuery));
$(document).ready(function(){wol.altmetrics.init()
});$(document).ready(function(){$(".js-header-user-access__trigger").click(function(c){var a=$("#login"),b=$(this).find(".icons-user-access-arrow"),d=$("#login"),f=250;
if(a.is(":visible")){d.fadeOut(f);
b.removeClass("icons-user-access-arrow_close");
b.addClass("icons-user-access-arrow_open")
}else{d.fadeIn(f);
b.removeClass("icons-user-access-arrow_open");
b.addClass("icons-user-access-arrow_close")
}return false
});
(function(){var b=$(".js-header-user-access__trigger"),a=b.find(".icons-user-access-arrow"),c=$("#login").not(".loggedIn");
c.mouseup(function(){return false
});
$(this).mouseup(function(d){if(!($(d.target).parent(".js-header-user-access__trigger").length>0)){c.fadeOut(250);
a.removeClass("icons-user-access-arrow_close");
a.addClass("icons-user-access-arrow_open")
}});
$(document).bind("keydown keypress",function(d){if(d.which==="27"){c.fadeOut(250);
a.removeClass("icons-user-access-arrow_close");
a.addClass("icons-user-access-arrow_open")
}})
}())
});(function(g,d){var c={padding:0,autoDimensions:false,width:480,height:"auto",autoScale:false,centerOnScroll:true,titleShow:false};
var f='<div class="loginContainer confirmContainer"><h1>Error</h1><p class="navAction message"><a href="#" id="confirm" class="actionBtn okBtn">OK</a>There has been an unexpected error, please try again.</p></div>';
var i=function(l){l.preventDefault();
var k=[],j;
c.target=d(l.target);
if(c.target.attr("type")&&c.target.attr("type")=="submit"){d(".validationRequired").validate({onclick:false,onfocusout:false,onkeyup:false,rules:{_checkbox_var:{required:true,minlength:1}},messages:{_checkbox_var:"Please select a journal title"},submitHandler:function(m){d.fancybox.staticUseSetup();
d.fancybox.showActivity();
j=d(m).attr("action");
k=d(m).serializeArray();
k.push({name:"reqType",value:"ajax"});
a(j,k)
}});
d(".validationRequired").submit()
}else{d.fancybox.staticUseSetup();
d.fancybox.showActivity();
j=c.target.attr("href");
k.push({name:"reqType",value:"ajax"});
a(j,k)
}};
var a=function(k,j){d.ajax({type:"GET",cache:false,url:k,data:j,success:function(l){b(l)
},error:function(){b(f)
}})
};
var e=function(l){d.fancybox.showActivity();
var k=d(l).attr("action");
var j=d(l).serializeArray();
j.push({name:"reqType",value:"ajax"});
d.ajax({type:"POST",cache:false,url:k,data:j,success:function(m){b(m)
},error:function(){d.fancybox.hideActivity();
var m=d('<p class="errorMsg">There has been an error, please try again.</p>');
d(".loginForm").find("input[name=password]").parent(".formField").after(m);
d.fancybox.resize()
}})
};
var b=function(j){c.content=j;
c.onComplete=function(){d("#cancelLogin").click(function(k){k.preventDefault();
d.fancybox.close()
});
d("#standaloneLogin").validate({onclick:false,onfocusout:false,onkeyup:false,submitHandler:function(k){e(k)
}});
d(".okBtn").click(function(k){k.preventDefault();
d.fancybox.close()
})
};
c.onCleanup=function(){var k=d(".okBtn").length&&d(".okBtn").parents("#fancybox-tmp").length!=1;
if(k){window.location.reload(true)
}};
d.fancybox(c)
};
var h=function(j){d.each(j.elms,function(l,m){var k=d(m);
k.click(i)
})
};
g.login={init:h};
return g
}(window.wol=window.wol||{},jQuery));
$(document).ready(function(){wol.login.init({elms:[".authReq"]})
});(function(i,h,f){var j=function(){h(".btnDecline").bind("click",function(o){o.preventDefault();
h.fancybox.close()
})
};
var n={invalidPages:[],viewPercentage:50,expiryDate:null,cookie:{key:"wolSurvey",value:"survey-seen"},width:400,height:400,padding:0,autoDimensions:false,autoScale:false,centerOnScroll:true,hideOnOverlayClick:false,onComplete:j};
var g=function(){var o=location.href,p=o.split("/");
return(o.lastIndexOf("/")!==o.length-1?p[p.length-1]:p[p.length-2])
};
var e=function(){var o=b();
var p=o<n.viewPercentage;
return p
};
var b=function(){return Math.floor(Math.random()*100)
};
var a=function(o){return h.inArray(o,n.invalidPages)===-1
};
var d=function(){var p=window.location.href.match(/(\?|&)interceptDebug($|&|=)/);
var o,q;
if(p){o=m("viewPercentage");
n.viewPercentage=o;
if(m("deleteCookie")=="1"){h.cookie(n.cookie.key,null,{path:"/"})
}}return p
};
var m=function(p){p=p.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");
var o="[\\?&]"+p+"=([^&#]*)";
var r=new RegExp(o);
var q=r.exec(window.location.search);
if(q==null){return""
}else{return decodeURIComponent(q[1].replace(/\+/g," "))
}};
var l=function(w){h.extend(n,w);
if(typeof n.expiryDate=="string"){var p=n.expiryDate.split("/");
var s=new Date(p[0],(p[1]-1),p[2]);
n.expiryDate=s
}else{n.expiryDate=new Date(new Date().getUTCFullYear()+1,new Date().getUTCMonth(),new Date().getUTCDate())
}var v=d(),o=g(),t=a(o),r=(h.cookie(n.cookie.key)==n.cookie.value),u=e(),q=(new Date()<n.expiryDate);
if(v){if(u&&!r){c()
}}else{if(q&&!r&&t&&u){h.cookie(n.cookie.key,n.cookie.value,{expires:new Date(n.expiryDate.setDate(n.expiryDate.getDate()+1)),path:"/"});
c()
}}};
var k=function(){h.getScript(i.config.staticAssetUrl+"js/jquery/jquery.ba-postmessage.js",function(){jQuery.receiveMessage(function(o){if(o.data==="closeFancyBox"){h.fancybox.close();
jQuery.receiveMessage()
}},i.config.staticAssetUrl.slice(0,-1));
h.fancybox(n)
})
};
var c=function(){if(n.href){n.type="iframe";
k()
}else{h("head").append('<link rel="stylesheet" href="../intercepts/css/interceptSurvey.css" type="text/css" />');
h.fancybox(n)
}};
i.intercept={init:l};
return i
}(window.wol=window.wol||{},jQuery));
$(document).ready(function(){wol.intercept.init({href:wol.config.staticAssetUrl+"intercepts/wol-survey.html?targetUrl="+encodeURIComponent(this.location.href),invalidPages:["pdf","full","abstract","references","citedby","suppinfo","versions","otherversions","figures","tables","compoundindex"],viewPercentage:15,expiryDate:"2013/08/31"})
});(function(a,c){var e=function(){c("a.rightsLink").bind("click",function(f){f.preventDefault();
b(c(this).attr("href"))
})
};
var b=function(f){var f=f.replace("%2526","%26");
window.open(f,"Rightslink","location=no,toolbar=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=650,height=550")
};
var d=function(){e()
};
a.rightsLink={init:d};
return a
}(window.wol=window.wol||{},jQuery));
$(function(){wol.rightsLink.init()
});(function(a){a.widget("ol.simpleCaptcha",{options:{imageCaptchaURL:"/captcha/html/image",audioCaptchaURL:"/captcha/html/audio",refreshImageCaptchaURL:"/captcha/image",refreshAudioCaptchaURL:"/captcha/audio",downloadAudioURL:"/captcha/download/audio",answerText:".captchAnswer"},vars:{audioCaptcha:".audio_captcha",bindAudioEvents:false},_create:function(){this._createTextCaptcha()
},_bindTextCaptchaActions:function(){var b=this,d=b.options,c=b.element;
c.delegate(".audioCaptcha","click",function(f){b._createAudioCaptcha();
f.preventDefault()
});
c.delegate(".text_captcha_refresh","click",function(f){b._refreshTextCaptcha();
f.preventDefault()
})
},_bindAudioCaptchaActions:function(){var b=this,d=b.options,c=b.element;
c.delegate(".textCaptcha","click",function(f){b._createTextCaptcha();
f.preventDefault()
});
if(!b.vars.bindAudioEvents){c.delegate(".audio_captcha_refresh","click",function(f){b._createAudioCaptcha();
f.preventDefault()
});
b.vars.bindAudioEvents=true
}},_createTextCaptcha:function(){var b=this,d=b.options,c=b.element;
a.ajax({url:d.imageCaptchaURL,data:"",type:"GET",success:function(e){a(c).html(e);
b._bindTextCaptchaActions()
}})
},_createAudioCaptcha:function(){var b=this,d=b.options,c=b.element;
a.ajax({url:d.audioCaptchaURL,data:"",type:"GET",cache:false,success:function(e){a(b.element).html(e);
b._bindAudioCaptchaActions();
if(b._isAudioSupported){a(b.vars.audioCaptcha).addClass("show_audio")
}}})
},_refreshTextCaptcha:function(){this.element.find(".text_captcha").attr("src",this.options.refreshImageCaptchaURL+"?"+new Date().getTime());
this._resetAnswer()
},_refreshAudioCaptcha:function(){var b=this,d=b.options,c=b.element;
c.find(b.vars.audioCaptcha).attr("src",this.options.refreshAudioCaptchaURL+"?"+new Date().getTime());
c.find(".download_audio").attr("href",this.options.downloadAudioURL);
c.find(b.vars.audioCaptcha).load();
b._resetAnswer()
},_resetAnswer:function(){this.element.find(this.options.answerText).val("")
},_isAudioSupported:function(){var b=document.createElement("audio");
return !!(b.canPlayType&&b.canPlayType('audio/wav; codecs="1"').replace(/no/,""))
}})
})(jQuery);(function(f,d){var b=9000,g=1000,h=".banner-section",c=d("html"),e=function(j){d(h+"> div:gt(0)").hide();
setInterval(function(){d(h+"> div:first").fadeOut(g).next().fadeIn(g).end().appendTo(h)
},b)
},a=function(){if(!!(0+document.createElement("div").style.animation)){c.addClass("cssAnimation")
}},i=function(){a();
e()
};
f.banner={init:i};
return f
}(window.wol=window.wol||{},jQuery));
$(document).ready(function(){wol.banner.init()
});var analytics=(function(){var a=function(b,c){if(!window.digitalData){return
}c=c||{};
digitalData.event=digitalData.event||[];
digitalData.event.push({eventInfo:{eventName:b,eventData:c}})
};
return{setTracking:a}
})();(function(j,e){var h=e(".allPdfDownloadLink").attr("href"),c="<a.+?\\s*href\\s*=\\s*[\"\\']?([^\"\\'\\s>]+)[\"\\']?",i="<a.+?\\s*data-access-granted\\s*=\\s*[\"\\']?([^\"\\'\\s>]+)[\"\\']?",m="<a.+?\\s*data-noc\\s*=\\s*[\"\\']?([^\"\\'\\s>]+)[\"\\']?",b=e.fancybox;
var a=function(n){n.preventDefault();
e.ajax({url:h,data:"type=ajax",type:"GET",beforeSend:function(){b.showActivity()
},success:function(o){b.hideActivity();
var p=o.match(c)[1],q=o.match(i)[1];
l(p,q,o);
window.location=p;
g()
},error:function(){b.hideActivity();
e(".overlay-inner").html("").text("There is something wrong to your request.")
}})
},l=function(p,r,n){var o="";
if(n.match(m)[1]){o=n.match(m)[1]
}if(r&&o&&window.digitalData){var q={numOfChapters:parseInt(o)};
analytics.setTracking("downloadAllChapters",q)
}},d=function(n){n.preventDefault();
b({padding:0,margin:0,content:k(),titleShow:false,autoScale:true,autoDimensions:false,height:200,width:482,scrolling:false,onComplete:function(){e(".button-group").delegate(".download","click",a);
e(".button-group").delegate(".overlay-close","click",g)
}})
},k=function(){var n="";
n+='<div class="overlay-wrapper">';
n+='<div class="overlay-inner">';
n+='<h3 class="downloadConfirmation">All Chapters PDF Download Confirmation</h3>';
n+='<p class="zipDownloadHeader">PDFs for all chapters will be downloaded in a .zip file</p>';
n+='<p class="confirmationMessage">Do you wish to proceed ?</p>';
n+='<div class="button-group"><button class="overlay-close" href="#">Cancel</button><button  href="#" class="download">OK</button></div>';
n+="</div></div>";
return n
},g=function(n){b.close()
},f=function(n){n.preventDefault();
return false
};
init=function(){e(document).delegate(".allPdfDownloadLink","click",d);
e(document).delegate(".allPdfDownloadLink","contextmenu",f)
};
j.allChapterDownload={init:init};
return j
}(window.wol=window.wol||{},jQuery));
$(document).ready(function(){wol.allChapterDownload.init()
});